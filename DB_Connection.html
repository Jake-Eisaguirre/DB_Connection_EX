<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Database Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="DB_Connection_files/libs/clipboard/clipboard.min.js"></script>
<script src="DB_Connection_files/libs/quarto-html/quarto.js"></script>
<script src="DB_Connection_files/libs/quarto-html/popper.min.js"></script>
<script src="DB_Connection_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="DB_Connection_files/libs/quarto-html/anchor.min.js"></script>
<link href="DB_Connection_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="DB_Connection_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="DB_Connection_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="DB_Connection_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="DB_Connection_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Database Tutorial</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#ribbitr-database-background" id="toc-ribbitr-database-background" class="nav-link active" data-scroll-target="#ribbitr-database-background">RIBBiTR Database Background</a>
  <ul class="collapse">
  <li><a href="#non-rdbms-example" id="toc-non-rdbms-example" class="nav-link" data-scroll-target="#non-rdbms-example">Non-RDBMS Example</a></li>
  <li><a href="#rdms-example" id="toc-rdms-example" class="nav-link" data-scroll-target="#rdms-example">RDMS Example</a></li>
  </ul></li>
  <li><a href="#how-to-connect-and-interact-with-the-ribbitr-data-base" id="toc-how-to-connect-and-interact-with-the-ribbitr-data-base" class="nav-link" data-scroll-target="#how-to-connect-and-interact-with-the-ribbitr-data-base">How to Connect and Interact with the RIBBiTR Data Base</a>
  <ul class="collapse">
  <li><a href="#necessary-librarys" id="toc-necessary-librarys" class="nav-link" data-scroll-target="#necessary-librarys">Necessary Library’s</a></li>
  <li><a href="#connecting" id="toc-connecting" class="nav-link" data-scroll-target="#connecting">Connecting</a>
  <ul class="collapse">
  <li><a href="#sample-.renviron-file-and-database-connection" id="toc-sample-.renviron-file-and-database-connection" class="nav-link" data-scroll-target="#sample-.renviron-file-and-database-connection">Sample .Renviron file and Database Connection</a></li>
  </ul></li>
  <li><a href="#interacting" id="toc-interacting" class="nav-link" data-scroll-target="#interacting">Interacting</a>
  <ul class="collapse">
  <li><a href="#dbqetquery" id="toc-dbqetquery" class="nav-link" data-scroll-target="#dbqetquery">dbQetQuery</a></li>
  <li><a href="#entire-sql-code-chunk" id="toc-entire-sql-code-chunk" class="nav-link" data-scroll-target="#entire-sql-code-chunk">Entire SQL Code Chunk</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="ribbitr-database-background" class="level2">
<h2 class="anchored" data-anchor-id="ribbitr-database-background">RIBBiTR Database Background</h2>
<p>Our RIBBITR data is stored in a PostgreSQL database, more commonly called “postgres”. Postgres is a free and open source relational database management system (RDBMS). Postgres RDBMS began development in 1982 at UC Berkeley initially under the name Ingres. After many years of development the project ended and Postgres was released under an MIT License that allowed other developers to utilize the code (open source) and continue developing the code. Following this, many evolution’s of the query language “SQL” occured. By 1997 PostgeSQL was released and SQL was deemed the unifying language for RDBMS style databases. To this day, developers around the world work to build upon the open source software of PostgreSQL and SQL to improve the software. Side note: RDBMS are one “flavor” of databases with new methods for data management systems being developed constantly, like “graph databases”.</p>
<p>Postges is considered a relational database management system (RDBMS) because each observation/row in a table contains a relationship to another observation/row in a different table. By maintaining relationships between data points you ensure the observations in that row will be joined correctly to each table. The rigid structure of the relationship between observations/rows from table to table is maintained through <code>primary keys</code> and <code>foreign keys</code>. A <code>primary key</code> from one table will be joined to the <code>foreign key</code> of the other table in which each row/observation will than align correctly between the two tables.</p>
<section id="non-rdbms-example" class="level3">
<h3 class="anchored" data-anchor-id="non-rdbms-example">Non-RDBMS Example</h3>
<p>For example, if you did not have a RDBMS and you had a <code>wind_speed</code> table that contains columns for “site”, “date”, and “wind_speed” and a <code>water_temp</code> table containing columns for “site”, “date”, and “water_temp” .</p>
<table class="table">
<thead>
<tr class="header">
<th>site</th>
<th>date</th>
<th>wind_speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>2022-01-03</td>
<td>22</td>
</tr>
<tr class="even">
<td>B</td>
<td>2022-08-10</td>
<td>24</td>
</tr>
<tr class="odd">
<td>C</td>
<td>2022-05-07</td>
<td>36</td>
</tr>
<tr class="even">
<td>A</td>
<td>2022-08-12</td>
<td>5</td>
</tr>
<tr class="odd">
<td>C</td>
<td>2022-09-14</td>
<td>12</td>
</tr>
</tbody>
</table>
<table class="table">
<thead>
<tr class="header">
<th>site</th>
<th>date</th>
<th>water_temp</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>2022-01-03</td>
<td>3</td>
</tr>
<tr class="even">
<td>B</td>
<td>2022-08-10</td>
<td>6</td>
</tr>
<tr class="odd">
<td>C</td>
<td>2022-05-07</td>
<td>23</td>
</tr>
<tr class="even">
<td>A</td>
<td>2022-08-12</td>
<td>18</td>
</tr>
<tr class="odd">
<td>C</td>
<td>2022-09-14</td>
<td>3</td>
</tr>
</tbody>
</table>
<p>Now say you wanted to join those two tables to have one table containing “site”, “date”, “wind_speed”, and “water_temp” you would <code>water_wind &lt;- left_join(water_temp, wind_speed, by = c("site", "date")</code> on the unique relationship of “site” and “date”. Or in human speak, when site and date between the two tables equal each other place the “water_temp” row in the table. With a RDBMS the creation of primary and foreign keys maintains the unique relationship of “site” and “date” between the two tables.</p>
<table class="table">
<thead>
<tr class="header">
<th>site</th>
<th>date</th>
<th>water_temp</th>
<th>wind_speed</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>2022-01-03</td>
<td>3</td>
<td>22</td>
</tr>
<tr class="even">
<td>B</td>
<td>2022-08-10</td>
<td>6</td>
<td>24</td>
</tr>
<tr class="odd">
<td>C</td>
<td>2022-05-07</td>
<td>23</td>
<td>36</td>
</tr>
<tr class="even">
<td>A</td>
<td>2022-08-12</td>
<td>18</td>
<td>5</td>
</tr>
<tr class="odd">
<td>C</td>
<td>2022-09-14</td>
<td>3</td>
<td>12</td>
</tr>
</tbody>
</table>
</section>
<section id="rdms-example" class="level3">
<h3 class="anchored" data-anchor-id="rdms-example">RDMS Example</h3>
<p>When looking at the <code>location</code> table and the <code>region</code> table within the <code>survey_data</code> schema in the RIBBiTR database we can see how the RDMS preserves the data and reduces space. We have three unique locations where data can be collected “panama”, “brazil”, and “usa” in which each of those locations can have many regions. For example, “usa” has regions of “california”, “new_mexico”, “vermount”, “tennessee”, “louisiana”, and “pennsylvania”. Through the use of primary and foreign keys we now know how to join those tables. And due to the primary and foreign keys we only need to maintain the unique sites and regions. This saves space by removing repeated values and preserves the data by only having one spelling of “usa”. You could imagine with the above example, if sites had upper case and lower case spellings we could improperly join the data.</p>
<p><strong>Location</strong> table</p>
<p><img src="images/image-246242273.png" class="img-fluid"></p>
<p><strong>Region</strong> table</p>
<p><img src="images/image-1359522731.png" class="img-fluid"></p>
<p>To join these two table we would join the <code>location</code> table primary key (location_id) to the <code>region</code> table foreign key (location_id). In RStudio, <code>location_region &lt;- left_join(location, region, by = c("location_id")</code></p>
<p><img src="images/image-2002484305.png" class="img-fluid"></p>
<p>We can now see the location column populates the correct value where ever the primary key and foreign key equal each other or in other words, the location_id from both tables equal each other.</p>
<p>Now if we zoom out and look at the entire structure of the <code>survey_data</code> schema we can see all the interconnected relationships built between the tables through primary keys and foreign keys. If there is a line connecting the tables we know the same structure follows/trickles through the schema with preserving space and data. Take a look at <a href="https://drive.google.com/drive/folders/1KBkHAjwyaCufJpM1qbcyN6F-pd_uJpxU">ribbitr_schema.pdf</a> for more info on each schema.</p>
<p><img src="images/image-1826824745.png" class="img-fluid"></p>
</section>
</section>
<section id="how-to-connect-and-interact-with-the-ribbitr-data-base" class="level1">
<h1>How to Connect and Interact with the RIBBiTR Data Base</h1>
<section id="necessary-librarys" class="level2">
<h2 class="anchored" data-anchor-id="necessary-librarys">Necessary Library’s</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres)  <span class="co"># The database driver</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)        <span class="co"># Functions needed to interact with the database</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstudioapi) <span class="co"># Package that asked for credentials </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The method below for calling in packages does the same as using `library` but will download any packages that are not initally downloaded. This is a cleaner method and more user friendly for sharing scripts between colleagues </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(librarian)){</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"librarian"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(librarian)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># librarian downloads, if not already downloaded, and reads in needed packages</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>librarian<span class="sc">::</span><span class="fu">shelf</span>(RPostgres, DBI, rstudioapi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="connecting" class="level2">
<h2 class="anchored" data-anchor-id="connecting">Connecting</h2>
<p>To connect to the database you will use <code>dbConnect</code> function from the <code>DBI</code> package. You will need the</p>
<ul>
<li><p>database driver: <code>drv = dbDriver("Postgres")</code>,</p></li>
<li><p>the database name: <code>dbname = "ribbitr"</code>,</p></li>
<li><p>the host: <code>host = "ribbitr.c6p56tuocn5n.us-west-1.rds.amazonaws.com"</code>,</p></li>
<li><p>port: <code>port = "5432"</code>,</p></li>
<li><p>your username: <code>user = "&lt;insert_username&gt;"</code></p></li>
<li><p>and password: <code>password = "&lt;insert_password&gt;"</code></p></li>
</ul>
<p>I strongly recommend not storing <code>user</code> and <code>password</code> , or any database info with in your script. A secure method for storing this info is in your <code>.Renviron</code> file that is stored locally on your device and will never be pushed to github. To edit your <code>.Renviron</code> file run this in the console: <code>usethis::edit_r_environ()</code> and the file will open. Populate the file based on the sample below, hit save, and restart your R session. You can then use <code>Sys.getenv()</code> to call on those variables stored locally on your device. Another method is to use the <code>rstudioapi</code> package with the <code>askForPassword()</code> function. Replace <code>Sys.getenv()</code> with <code>askForPassword()</code>. A log in box will appear after running the <code>dbConnect</code>.</p>
<p>Once you have connected to the database it is important to <code>set search_path</code> to the appropriate database schema of interest. This is identical to setting your working directory but for databases. To set search path we will use <code>dbSendQuery</code> in the <code>DBI</code> package. You will tell the <code>dbSendQuery</code> the connection and the SQL statement that points to the schema. Note, you must use single quotes around the schema of choice <code>dbSendQuery(conn = ribbitr_connection, "set search_path = 'survey_data'")</code></p>
<section id="sample-.renviron-file-and-database-connection" class="level3">
<h3 class="anchored" data-anchor-id="sample-.renviron-file-and-database-connection">Sample .Renviron file and Database Connection</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) run this in the console: "usethis::edit_r_environ()"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) copy the sample below and input your own username and password.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3) Save and restart your r sessio. Click "session" at the top and "Restart R".</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sample .Renviron file #</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dbname <span class="ot">=</span> <span class="st">"ribbitr"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>host <span class="ot">=</span> <span class="st">"ribbitr.c6p56tuocn5n.us-west-1.rds.amazonaws.com"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>port <span class="ot">=</span> <span class="st">"5432"</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>user <span class="ot">=</span> <span class="st">"username"</span> <span class="co"># you will input your own username</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>password <span class="ot">=</span> <span class="st">"password"</span> <span class="co"># you will input your own password</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># connecting to RIBBiTR Database</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>ribbitr_connection <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="at">drv =</span> <span class="fu">dbDriver</span>(<span class="st">"Postgres"</span>),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">dbname =</span> <span class="st">"ribbitr"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">host =</span> <span class="st">"ribbitr.c6p56tuocn5n.us-west-1.rds.amazonaws.com"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                                <span class="at">port =</span> <span class="st">"5432"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">user =</span> <span class="fu">Sys.getenv</span>(<span class="st">"aws_user"</span>),</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                                <span class="at">password =</span> <span class="fu">Sys.getenv</span>(<span class="st">"aws_password"</span>))</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Same method for connecting to RIBBiTR databse but will give feedback, I recommend copying this</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tryCatch</span>({</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Connecting to Database…"</span>)</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    ribbitr_connection <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="at">drv =</span> <span class="fu">dbDriver</span>(<span class="st">"Postgres"</span>),</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">dbname =</span> <span class="st">"ribbitr"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">host =</span> <span class="st">"ribbitr.c6p56tuocn5n.us-west-1.rds.amazonaws.com"</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">port =</span> <span class="st">"5432"</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">user =</span> <span class="fu">askForPassword</span>(<span class="st">"user"</span>),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">password =</span> <span class="fu">askForPassword</span>(<span class="st">"password"</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"Database Connected!"</span>)</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">error=</span><span class="cf">function</span>(cond) {</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">print</span>(<span class="st">"Unable to connect to Database."</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co"># setting your search path</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dbSendQuery</span>(<span class="at">conn =</span> ribbitr_connection, </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">statement =</span> <span class="st">"set search_path = 'survey_data'"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="interacting" class="level2">
<h2 class="anchored" data-anchor-id="interacting">Interacting</h2>
<p>Now you should be connected to the <code>ribbitr</code> database with in RStudio and working with in the <code>survey_data</code> schema. Interacting with the database through R will involve learning some SQL. Don’t stress, SQL is a very intuitive and straight forward language. A more thorough SQL tutorial will follow and please do not hesitate to reach out for help with developing queries. I will now show two methods in how one can query the database.</p>
<section id="dbqetquery" class="level3">
<h3 class="anchored" data-anchor-id="dbqetquery">dbQetQuery</h3>
<p>Using <code>dbQetQuery</code> in the <code>DBI</code> package we can feed the function our database connection <code>conn = ribbitr_connection</code> and then the SQL <code>statement =</code>. Note, the <code>*</code> symbol in SQL is equivalent as saying “everything” and in R that is <code>.</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># location table only</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># human speak: "select everthing from the location table"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>sql_statement <span class="ot">&lt;-</span> <span class="st">"select * from location"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> ribbitr_connection, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">statement =</span> sql_statement)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># location and region table joined</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># human speak: "select the location column from the location table and the region column from                 the region table then join region onto the location when location table                        location_id equals the region table location_id."</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># note, if you want to select specific columns from a table you must start with table alias, that being either "l" for location or "r" for region. </span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>sql_statement <span class="ot">&lt;-</span> <span class="st">"select l.location, r.region </span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="st">                  from location l</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="st">                  join region r on l.location_id = r.location_id"</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>location_region <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> ribbitr_connection, </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">statement =</span> sql_statement)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># picking columns of interest from each table and join all tables together. Try to always select specific columns of interest from each table.</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>sql_statement <span class="ot">&lt;-</span> <span class="st">"select l.location, r.region, s.site, s.utme, s.utmn, s.utm_zone,</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="st">                  v.date, v.survey_time, su.start_time, su.end_time, su.duration_minutes,</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="st">                  c.species_capture, c.time_of_capture, c.body_temp_c, c.svl_mm, c.sex</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="st">                  from location l</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="st">                  join region r on l.location_id = r.location_id </span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="st">                  join site s on r.region_id = s.region_id </span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="st">                  join visit v on s.site_id = v.site_id </span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="st">                  join survey su on v.visit_id = su.visit_id </span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="st">                  join capture c on su.survey_id = c.survey_id;"</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>capture_data <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(<span class="at">conn =</span> ribbitr_connection, </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                              <span class="at">statement =</span> sql_statement)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="entire-sql-code-chunk" class="level3">
<h3 class="anchored" data-anchor-id="entire-sql-code-chunk">Entire SQL Code Chunk</h3>
<p>If you are using a Quarto or RMarkdown document with code chunks you can specify in the code chunk that you will be using SQL, the database connection, and what you want the output variable to be.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> location</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> l.location, r.region, s.site, s.utme, s.utmn, s.utm_zone,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>v.<span class="dt">date</span>, v.survey_time, su.start_time, su.end_time, su.duration_minutes,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>c.species_capture, c.time_of_capture, c.body_temp_c, c.svl_mm, c.sex</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> location l</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">join</span> region r <span class="kw">on</span> l.location_id <span class="op">=</span> r.location_id </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">join</span> site s <span class="kw">on</span> r.region_id <span class="op">=</span> s.region_id </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">join</span> visit v <span class="kw">on</span> s.site_id <span class="op">=</span> v.site_id </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">join</span> survey su <span class="kw">on</span> v.visit_id <span class="op">=</span> su.visit_id </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">join</span> capture c <span class="kw">on</span> su.survey_id <span class="op">=</span> c.survey_id;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>